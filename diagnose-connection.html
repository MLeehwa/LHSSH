<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—°ê²° ì§„ë‹¨ ë„êµ¬</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        .result { 
            margin: 10px 0; 
            padding: 15px; 
            border-radius: 5px;
            border-left: 4px solid;
        }
        .success { 
            background-color: #d4edda; 
            color: #155724; 
            border-color: #28a745;
        }
        .error { 
            background-color: #f8d7da; 
            color: #721c24; 
            border-color: #dc3545;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border-color: #ffc107;
        }
        .info { 
            background-color: #d1ecf1; 
            color: #0c5460; 
            border-color: #17a2b8;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ì—°ê²° ì§„ë‹¨ ë„êµ¬</h1>
        <p>Supabase ì—°ê²° ë¬¸ì œë¥¼ ì§„ë‹¨í•©ë‹ˆë‹¤.</p>
        
        <div class="test-section">
            <h2>1. ê¸°ë³¸ ë„¤íŠ¸ì›Œí¬ í™•ì¸</h2>
            <button onclick="testBasicNetwork()">ì¸í„°ë„· ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            <div id="networkResult"></div>
        </div>

        <div class="test-section">
            <h2>2. DNS í•´ì„ í™•ì¸</h2>
            <button onclick="testDNS()">DNS í•´ì„ í…ŒìŠ¤íŠ¸</button>
            <div id="dnsResult"></div>
        </div>

        <div class="test-section">
            <h2>3. Supabase URL ì§ì ‘ ì ‘ê·¼</h2>
            <button onclick="testSupabaseURL()">Supabase URL í…ŒìŠ¤íŠ¸</button>
            <div id="urlResult"></div>
        </div>

        <div class="test-section">
            <h2>4. Supabase í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸</h2>
            <button onclick="testSupabaseClient()">í´ë¼ì´ì–¸íŠ¸ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            <div id="clientResult"></div>
        </div>

        <div class="test-section">
            <h2>5. ì „ì²´ ì§„ë‹¨ ì‹¤í–‰</h2>
            <button onclick="runFullDiagnosis()">ì „ì²´ ì§„ë‹¨ ì‹¤í–‰</button>
            <div id="fullResult"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://vzemucykhxlxgjuldibf.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ6ZW11Y3lraHhseGdqdWxkaWJmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMzNzA4MjcsImV4cCI6MjA2ODk0NjgyN30.L9DN-V33rQj6atDnDhVeIOyzGP5I_3uVWSVfMObqrbQ';

        function addResult(containerId, message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            document.getElementById(containerId).appendChild(div);
        }

        function clearResult(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        async function testBasicNetwork() {
            clearResult('networkResult');
            addResult('networkResult', 'ì¸í„°ë„· ì—°ê²° í™•ì¸ ì¤‘...', 'info');
            
            try {
                const response = await fetch('https://www.google.com/favicon.ico', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                addResult('networkResult', 'âœ… ì¸í„°ë„· ì—°ê²° ì •ìƒ', 'success');
            } catch (error) {
                addResult('networkResult', 'âŒ ì¸í„°ë„· ì—°ê²° ì‹¤íŒ¨: ' + error.message, 'error');
                addResult('networkResult', 'ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'warning');
            }
        }

        async function testDNS() {
            clearResult('dnsResult');
            addResult('dnsResult', `DNS í•´ì„ í™•ì¸ ì¤‘: <code>${SUPABASE_URL}</code>`, 'info');
            
            try {
                const url = new URL(SUPABASE_URL);
                const hostname = url.hostname;
                
                // DNS í•´ì„ ì‹œë„
                const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                
                addResult('dnsResult', `âœ… DNS í•´ì„ ì„±ê³µ: <code>${hostname}</code>`, 'success');
            } catch (error) {
                if (error.message.includes('Failed to fetch') || error.name === 'TypeError') {
                    addResult('dnsResult', 'âŒ DNS í•´ì„ ì‹¤íŒ¨ (ERR_NAME_NOT_RESOLVED)', 'error');
                    addResult('dnsResult', 'ê°€ëŠ¥í•œ ì›ì¸:', 'warning');
                    addResult('dnsResult', '1. Supabase í”„ë¡œì íŠ¸ê°€ ì‚­ì œë˜ì—ˆê±°ë‚˜ ì¼ì‹œ ì¤‘ì§€ë¨', 'warning');
                    addResult('dnsResult', '2. ë„¤íŠ¸ì›Œí¬ ë°©í™”ë²½ ë˜ëŠ” í”„ë¡ì‹œ ì„¤ì • ë¬¸ì œ', 'warning');
                    addResult('dnsResult', '3. DNS ì„œë²„ ë¬¸ì œ', 'warning');
                } else {
                    addResult('dnsResult', 'âŒ ì˜¤ë¥˜: ' + error.message, 'error');
                }
            }
        }

        async function testSupabaseURL() {
            clearResult('urlResult');
            addResult('urlResult', `Supabase URL ì§ì ‘ ì ‘ê·¼ í…ŒìŠ¤íŠ¸: <code>${SUPABASE_URL}</code>`, 'info');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {
                    method: 'GET',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok || response.status === 200 || response.status === 404) {
                    addResult('urlResult', 'âœ… Supabase ì„œë²„ ì‘ë‹µ ì •ìƒ', 'success');
                    addResult('urlResult', `ìƒíƒœ ì½”ë“œ: ${response.status}`, 'info');
                } else {
                    addResult('urlResult', `âš ï¸ Supabase ì„œë²„ ì‘ë‹µ: ${response.status}`, 'warning');
                }
            } catch (error) {
                if (error.message.includes('Failed to fetch')) {
                    addResult('urlResult', 'âŒ Supabase ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                    addResult('urlResult', `ì˜¤ë¥˜: ${error.message}`, 'error');
                    addResult('urlResult', 'í•´ê²° ë°©ë²•:', 'warning');
                    addResult('urlResult', '1. Supabase ëŒ€ì‹œë³´ë“œì—ì„œ í”„ë¡œì íŠ¸ ìƒíƒœ í™•ì¸', 'warning');
                    addResult('urlResult', '2. í”„ë¡œì íŠ¸ URLì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸', 'warning');
                    addResult('urlResult', '3. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë° ë°©í™”ë²½ ì„¤ì • í™•ì¸', 'warning');
                } else {
                    addResult('urlResult', 'âŒ ì˜¤ë¥˜: ' + error.message, 'error');
                }
            }
        }

        async function testSupabaseClient() {
            clearResult('clientResult');
            addResult('clientResult', 'Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì¤‘...', 'info');
            
            try {
                if (typeof window.supabase === 'undefined') {
                    addResult('clientResult', 'âŒ Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                    return;
                }
                
                addResult('clientResult', 'âœ… Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì„±ê³µ', 'success');
                
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                addResult('clientResult', 'âœ… Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì„±ê³µ', 'success');
                
                addResult('clientResult', 'parts í…Œì´ë¸” ì¡°íšŒ ì‹œë„...', 'info');
                const { data, error } = await supabase
                    .from('parts')
                    .select('count')
                    .limit(1);
                
                if (error) {
                    addResult('clientResult', `âŒ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ì‹¤íŒ¨: ${error.message}`, 'error');
                    addResult('clientResult', `ì˜¤ë¥˜ ì½”ë“œ: ${error.code || 'N/A'}`, 'error');
                } else {
                    addResult('clientResult', 'âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ', 'success');
                }
            } catch (error) {
                addResult('clientResult', 'âŒ í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message, 'error');
                console.error('ì „ì²´ ì˜¤ë¥˜:', error);
            }
        }

        async function runFullDiagnosis() {
            clearResult('fullResult');
            addResult('fullResult', '<h3>ì „ì²´ ì§„ë‹¨ ì‹œì‘...</h3>', 'info');
            
            // 1. ë„¤íŠ¸ì›Œí¬ í™•ì¸
            addResult('fullResult', '<strong>1. ê¸°ë³¸ ë„¤íŠ¸ì›Œí¬ í™•ì¸</strong>', 'info');
            await testBasicNetwork();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // 2. DNS í™•ì¸
            addResult('fullResult', '<strong>2. DNS í•´ì„ í™•ì¸</strong>', 'info');
            await testDNS();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // 3. URL í™•ì¸
            addResult('fullResult', '<strong>3. Supabase URL í™•ì¸</strong>', 'info');
            await testSupabaseURL();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // 4. í´ë¼ì´ì–¸íŠ¸ í™•ì¸
            addResult('fullResult', '<strong>4. Supabase í´ë¼ì´ì–¸íŠ¸ í™•ì¸</strong>', 'info');
            await testSupabaseClient();
            
            addResult('fullResult', '<h3>âœ… ì§„ë‹¨ ì™„ë£Œ</h3>', 'success');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì „ì²´ ì§„ë‹¨ ì‹¤í–‰
        window.addEventListener('load', () => {
            setTimeout(runFullDiagnosis, 1000);
        });
    </script>
</body>
</html>

