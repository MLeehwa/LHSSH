<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실사 재고 - 이화 - 서한 시스템</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Design System -->
    <link rel="stylesheet" href="../css/design-system.css">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        function configureTailwind() {
            if (window.tailwind) {
                tailwind.config = {
                    theme: {
                        extend: {
                            colors: {
                                primary: '#3B82F6',
                                secondary: '#64748B',
                                success: '#10B981',
                                warning: '#F59E0B',
                                danger: '#EF4444'
                            }
                        }
                    }
                }
            } else {
                setTimeout(configureTailwind, 100);
            }
        }
        document.addEventListener('DOMContentLoaded', configureTailwind);
        window.NODE_ENV = 'development';
    </script>
    <style>
        /* 상태 배지 스타일 */
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-active {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-completed {
            background: #dcfce7;
            color: #166534;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-matched {
            background: #dcfce7;
            color: #166534;
        }

        .status-difference {
            background: #fef3c7;
            color: #92400e;
        }

        .status-adjusted {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-default {
            background: #f3f4f6;
            color: #374151;
        }

        .text-success {
            color: #059669;
        }

        .text-danger {
            color: #dc2626;
        }

        .text-muted {
            color: #6b7280;
        }
    </style>
</head>

<body>
    <div class="app-layout">
        <!-- Sidebar (공통 컴포넌트) -->
        <aside id="shared-sidebar" class="ds-sidebar"></aside>
        <script src="../js/sidebar.js?v=20260221"></script>

        <!-- Main Content -->
        <div class="app-content">
            <!-- Header -->
            <header class="ds-header">
                <div>
                    <h1 class="ds-header-title">실사 재고</h1>
                    <p class="ds-header-subtitle">PDA 실사 데이터 확인 및 재고 수정</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="exportBtn"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center">
                        <i class="fas fa-download mr-2"></i>
                        내보내기
                    </button>
                    <div class="relative">
                        <select id="exportFormat"
                            class="bg-white/90 backdrop-blur-md border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="csv">CSV</option>
                            <option value="excel">Excel</option>
                        </select>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <div class="flex-1 overflow-auto p-6">
                <!-- 알림 컨테이너 -->
                <div id="alertContainer" class="mb-4"></div>

                <!-- Statistics Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div
                        class="glass-effect rounded-xl border-2 border-gray-200 p-6 card-shadow stat-card animate-slide-up">
                        <div class="flex items-center">
                            <div class="p-2 bg-blue-500/20 rounded-lg">
                                <i class="fas fa-clipboard-list text-blue-300 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-800/80">총 실사 항목</p>
                                <p id="totalItems" class="text-2xl font-bold text-gray-800">0</p>
                            </div>
                        </div>
                    </div>

                    <div
                        class="glass-effect rounded-xl border-2 border-gray-200 p-6 card-shadow stat-card animate-slide-up">
                        <div class="flex items-center">
                            <div class="p-2 bg-green-500/20 rounded-lg">
                                <i class="fas fa-check-circle text-green-300 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-800/80">일치 항목</p>
                                <p id="matchedItems" class="text-2xl font-bold text-green-300">0</p>
                            </div>
                        </div>
                    </div>

                    <div
                        class="glass-effect rounded-xl border-2 border-gray-200 p-6 card-shadow stat-card animate-slide-up">
                        <div class="flex items-center">
                            <div class="p-2 bg-red-500/20 rounded-lg">
                                <i class="fas fa-exclamation-triangle text-red-300 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-800/80">불일치 항목</p>
                                <p id="mismatchedItems" class="text-2xl font-bold text-red-300">0</p>
                            </div>
                        </div>
                    </div>

                    <div
                        class="glass-effect rounded-xl border-2 border-gray-200 p-6 card-shadow stat-card animate-slide-up">
                        <div class="flex items-center">
                            <div class="p-2 bg-yellow-500/20 rounded-lg">
                                <i class="fas fa-edit text-yellow-300 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-800/80">수정된 항목</p>
                                <p id="modifiedItems" class="text-2xl font-bold text-yellow-300">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="glass-effect rounded-xl border-2 border-gray-200 mb-6 card-shadow">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">필터</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-800/80 mb-2">세션 선택</label>
                                <select id="sessionSelect"
                                    class="w-full px-3 py-2 bg-white/90 backdrop-blur-md border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900">
                                    <option value="">세션을 선택하세요</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-800/80 mb-2">시작 날짜</label>
                                <input type="date" id="startDate"
                                    class="w-full px-3 py-2 bg-white/90 backdrop-blur-md border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-800/80 mb-2">종료 날짜</label>
                                <input type="date" id="endDate"
                                    class="w-full px-3 py-2 bg-white/90 backdrop-blur-md border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900">
                            </div>
                        </div>
                        <div class="mt-4 flex space-x-2">
                            <button id="filterBtn"
                                class="bg-blue-600 text-gray-800 px-4 py-2 rounded-lg hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center">
                                <i class="fas fa-search mr-2"></i>
                                검색
                            </button>
                            <button id="clearFilterBtn"
                                class="bg-gray-500 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-600 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center">
                                <i class="fas fa-times mr-2"></i>
                                초기화
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 실사 세션 목록 -->
                <div id="sessionsSection" class="glass-effect rounded-xl border-2 border-gray-200 mb-6 card-shadow">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-lg font-semibold text-gray-800">실사 세션 목록</h2>
                            <button
                                class="refresh-btn bg-blue-600 text-gray-800 px-4 py-2 rounded-lg hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center">
                                <i class="fas fa-sync-alt mr-2"></i>
                                새로고침
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-white/20 border-2 border-gray-200">
                            <thead class="bg-white/10 sticky top-0 z-10">
                                <tr>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-800/80 uppercase tracking-wider">
                                        세션명</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-800/80 uppercase tracking-wider">
                                        실사 날짜</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-800/80 uppercase tracking-wider">
                                        상태</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-800/80 uppercase tracking-wider">
                                        생성일시</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-800/80 uppercase tracking-wider">
                                        작업</th>
                                </tr>
                            </thead>
                            <tbody id="sessionsTableBody" class="bg-white/5 divide-y divide-white/20">
                                <!-- 세션 목록이 JavaScript로 생성됨 -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 실사 세션 상세 -->
                <div id="sessionDetailsSection"
                    class="glass-effect rounded-xl border-2 border-gray-200 mb-6 card-shadow" style="display: none;">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-lg font-semibold text-gray-800">실사 세션 상세</h2>
                                <div class="mt-2 text-sm text-gray-800/70">
                                    <span>세션명: <span id="sessionName" class="font-medium text-gray-800"></span></span>
                                    <span class="mx-2">|</span>
                                    <span>날짜: <span id="sessionDate" class="font-medium text-gray-800"></span></span>
                                    <span class="mx-2">|</span>
                                    <span>상태: <span id="sessionStatus" class="font-medium text-gray-800"></span></span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <button
                                    class="complete-session-btn bg-green-600 text-gray-800 px-4 py-2 rounded-lg hover:bg-green-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center">
                                    <i class="fas fa-check mr-2"></i>
                                    세션 완료
                                </button>
                                <button onclick="window.physicalInventoryAdmin.showSessionsList()"
                                    class="bg-gray-600 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center">
                                    <i class="fas fa-arrow-left mr-2"></i>
                                    목록으로
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 실사 항목 목록 -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-white/20 border-2 border-gray-200">
                            <thead class="bg-white/10 sticky top-0 z-10">
                                <tr>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-800/80 uppercase tracking-wider">
                                        파트 번호</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-800/80 uppercase tracking-wider">
                                        DB 재고</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-800/80 uppercase tracking-wider">
                                        실사 재고</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-800/80 uppercase tracking-wider">
                                        차이</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-800/80 uppercase tracking-wider">
                                        상태</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-800/80 uppercase tracking-wider w-48">
                                        비고</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-800/80 uppercase tracking-wider">
                                        작업</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryItemsTableBody" class="bg-white/5 divide-y divide-white/20">
                                <!-- 실사 항목 목록이 JavaScript로 생성됨 -->
                            </tbody>
                        </table>
                    </div>

                    <!-- 실사 재고 직접 입력 섹션 -->
                    <div class="p-6 border-t border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">실사 재고 직접 입력</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-800/80 mb-2">파트 번호</label>
                                <select id="manualPartSelect"
                                    class="w-full px-3 py-2 bg-white/90 backdrop-blur-md border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900">
                                    <option value="">파트를 선택하세요</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-800/80 mb-2">실사 재고 수량</label>
                                <input type="number" id="manualPhysicalStock" min="0"
                                    class="w-full px-3 py-2 bg-white/90 backdrop-blur-md border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"
                                    placeholder="실사 수량 입력">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-800/80 mb-2">비고</label>
                                <input type="text" id="manualNotes"
                                    class="w-full px-3 py-2 bg-white/90 backdrop-blur-md border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"
                                    placeholder="비고 입력">
                            </div>
                            <div class="flex items-end">
                                <button id="addManualItemBtn"
                                    class="w-full bg-blue-600 text-gray-800 px-4 py-2 rounded-lg hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center">
                                    <i class="fas fa-plus mr-2"></i>
                                    추가
                                </button>
                            </div>
                        </div>
                    </div>
                </div>




            </div>
        </div>
    </div>

    <script src="../js/config.js?v=20260217"></script>
    <script src="../js/supabase-client.js?v=20260217"></script>
    <script src="../js/physical-inventory-admin.js?v=20260217"></script>
    <script>
        // PhysicalInventoryAdmin 인스턴스 생성
        let physicalInventoryAdmin;

        // DOM이 로드된 후 초기화
        document.addEventListener('DOMContentLoaded', async () => {
            physicalInventoryAdmin = new PhysicalInventoryAdmin();
            window.physicalInventoryAdmin = physicalInventoryAdmin; // 전역 접근을 위해
        });

        // 로그아웃 함수
        function logout() {
            // 로컬 스토리지에서 인증 정보 제거
            localStorage.removeItem('authToken');
            localStorage.removeItem('userInfo');
            localStorage.removeItem('userMode');

            // 로그인 페이지로 리다이렉트
            window.location.href = '../login.html';
        }

        // 현재 시간 표시
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'America/Chicago'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        updateTime();
        setInterval(updateTime, 1000);
    </script>
</body>

</html>