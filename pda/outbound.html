<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title data-i18n="outbound_title">출고 작업 - 이화 - 서한 시스템</title>
    
    <!-- Supabase 클라이언트 라이브러리 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- i18n 스크립트 -->
    <script src="../js/i18n.js"></script>
    
    <!-- Supabase 설정 -->
    <script src="../js/config.js"></script>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- 키보드 숨김 기능 -->
    <script>
        // 강화된 키보드 숨김 함수
        function hideKeyboard() {
            // 1. 모든 입력 필드에서 포커스 제거
            const inputs = document.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                input.blur();
                input.setAttribute('readonly', 'readonly');
                input.setAttribute('tabindex', '-1');
                setTimeout(() => {
                    input.removeAttribute('readonly');
                    input.removeAttribute('tabindex');
                }, 100);
            });
            
            // 2. 화면을 터치하여 키보드 숨김
            document.body.click();
            
            // 3. 모바일에서 키보드 숨김을 위한 추가 처리
            if (window.scrollTo) {
                window.scrollTo(0, 0);
            }
            
            // 4. 가상 키보드 숨김을 위한 추가 처리
            document.activeElement && document.activeElement.blur();
            
            // 5. 포커스를 body로 이동
            document.body.focus();
            
            // 6. 입력 필드 비활성화 후 재활성화
            inputs.forEach(input => {
                input.disabled = true;
                setTimeout(() => {
                    input.disabled = false;
                }, 50);
            });
        }
        
        // 포커스 제어 함수 (차수 선택 후에만 적용)
        function preventInputFocus() {
            // 차수가 선택되지 않은 경우 아무것도 하지 않음
            if (!currentShift) {
                console.log('차수가 선택되지 않아 포커스 제어를 적용하지 않음');
                return;
            }
            
            console.log('차수 선택 후 포커스 제어 적용:', currentShift);
            
            // 일반 텍스트 입력 필드만 포커스 방지 (드롭다운은 제외)
            const textInputs = document.querySelectorAll('input[type="text"]:not(#barcodeInput):not(#dateSelect), input[type="number"], textarea');
            textInputs.forEach(input => {
                // 포커스 이벤트 방지
                input.addEventListener('focus', function(e) {
                    e.preventDefault();
                    e.target.blur();
                    hideKeyboard();
                });
                
                // 클릭 이벤트 방지
                input.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.target.blur();
                    hideKeyboard();
                });
                
                // 터치 이벤트 방지
                input.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    e.target.blur();
                    hideKeyboard();
                });
            });
        }
        
        // contenteditable 헬퍼 함수
        function getBarcodeValue() {
            const barcodeInput = document.getElementById('barcodeInput');
            if (!barcodeInput) return '';
            return (barcodeInput.textContent || barcodeInput.innerText || '').trim();
        }
        
        function setBarcodeValue(value) {
            const barcodeInput = document.getElementById('barcodeInput');
            if (barcodeInput) {
                barcodeInput.textContent = value || '';
                barcodeInput.innerText = value || '';
            }
        }
        
        // 바코드 입력 필드 특별 처리 (contenteditable 사용, 전역 키보드 이벤트로 처리)
        function setupBarcodeInput() {
            const barcodeInput = document.getElementById('barcodeInput');
            if (barcodeInput) {
                // contenteditable은 키보드를 띄울 수 있으므로, 전역 키보드 이벤트로 처리
                // 자동 포커스 설정 (파트 섹션이 보일 때만)
                const partsSection = document.getElementById('partsSection');
                if (partsSection && !partsSection.classList.contains('hidden')) {
                    setTimeout(() => {
                        barcodeInput.focus();
                        console.log('바코드 입력 필드 포커스 설정됨 (출고)');
                    }, 500);
                }
                
                // 포커스 유지 (파트 섹션이 보일 때만)
                barcodeInput.addEventListener('blur', function() {
                    setTimeout(() => {
                        const partsSection = document.getElementById('partsSection');
                        if (partsSection && !partsSection.classList.contains('hidden') && currentShift) {
                            this.focus();
                            console.log('바코드 입력 필드 포커스 복원 (출고)');
                        }
                    }, 100);
                });
                
                // contenteditable에 직접 입력될 때 처리 (백업용)
                barcodeInput.addEventListener('keydown', function(e) {
                    // Enter 키 처리
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const text = getBarcodeValue();
                        if (text.trim()) {
                            scanBarcode();
                        }
                        setBarcodeValue('');
                        return;
                    }
                    // 일반 문자 입력은 전역 이벤트가 처리하므로 여기서는 로그만
                    if (e.key.length === 1) {
                        console.log('contenteditable에 직접 입력 (출고):', e.key);
                    }
                });
            }
        }
        
        // 페이지 로드 시 키보드 숨김
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(hideKeyboard, 100);
            setTimeout(hideKeyboard, 500);
            setTimeout(hideKeyboard, 1000);
            // preventInputFocus는 차수 선택 후에만 호출
            setTimeout(setupBarcodeInput, 300);
        });
        
        // 화면 터치 시 키보드 숨김 (차수 선택 전에는 드롭다운 방해하지 않음)
        document.addEventListener('touchstart', function(e) {
            // 차수가 선택되지 않은 경우 드롭다운은 완전히 자유롭게
            if (!currentShift) {
                return;
            }
            
            // 드롭다운과 날짜 선택, 바코드 입력은 제외
            if (!e.target.matches('input, textarea, select, button') || 
                e.target.matches('#shiftSelect, #asPartSelect, #dateSelect, #barcodeInput')) {
                hideKeyboard();
            }
        });
        
        // 포커스 이벤트 시 키보드 숨김 (차수 선택 전에는 드롭다운 방해하지 않음)
        document.addEventListener('focusin', function(e) {
            // 차수가 선택되지 않은 경우 드롭다운은 완전히 자유롭게
            if (!currentShift) {
                return;
            }
            
            // 드롭다운과 날짜 선택, 바코드 입력은 제외
            if (!e.target.matches('input, textarea, select') || 
                e.target.matches('#shiftSelect, #asPartSelect, #dateSelect, #barcodeInput')) {
                hideKeyboard();
            }
        });
        
        // 키보드 이벤트 시 키보드 숨김
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideKeyboard();
            }
        });
    </script>
    
    <script>
        // Tailwind 설정은 CDN 로드 후에 실행
        function configureTailwind() {
            if (window.tailwind) {
                tailwind.config = {
                    theme: {
                        extend: {
                            colors: {
                                primary: '#3B82F6',
                                secondary: '#64748B',
                                success: '#10B981',
                                warning: '#F59E0B',
                                danger: '#EF4444'
                            },
                            animation: {
                                'fade-in': 'fadeIn 0.5s ease-in-out',
                                'slide-up': 'slideUp 0.5s ease-out',
                                'bounce-in': 'bounceIn 0.6s ease-out',
                                'float': 'float 3s ease-in-out infinite',
                                'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite'
                            },
                            keyframes: {
                                fadeIn: {
                                    '0%': { opacity: '0' },
                                    '100%': { opacity: '1' }
                                },
                                slideUp: {
                                    '0%': { transform: 'translateY(20px)', opacity: '0' },
                                    '100%': { transform: 'translateY(0)', opacity: '1' }
                                },
                                bounceIn: {
                                    '0%': { transform: 'scale(0.3)', opacity: '0' },
                                    '50%': { transform: 'scale(1.05)' },
                                    '70%': { transform: 'scale(0.9)' },
                                    '100%': { transform: 'scale(1)', opacity: '1' }
                                },
                                float: {
                                    '0%, 100%': { transform: 'translateY(0px)' },
                                    '50%': { transform: 'translateY(-10px)' }
                                }
                            }
                        }
                    }
                }
            } else {
                // CDN이 아직 로드되지 않았다면 잠시 후 다시 시도
                setTimeout(configureTailwind, 100);
            }
        }
        
        // 페이지 로드 시 Tailwind 설정
        document.addEventListener('DOMContentLoaded', configureTailwind);
    </script>
    <style>
        /* PDA 최적화 스타일 */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .action-button {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            border: none;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .action-button:active::before {
            left: 100%;
        }
        
        .action-button:active {
            transform: scale(0.98);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }
        
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .cancel-btn {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
        }
        
        .dropdown-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            transition: all 0.3s ease;
        }
        
        .dropdown-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .scan-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 18px;
            text-align: center;
            background: white;
            transition: all 0.3s ease;
        }
        
        .scan-input:focus {
            outline: none;
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }
        
        .main-menu-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 12px;
            padding: 12px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
        }
        
        .main-menu-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .main-menu-btn:active {
            transform: scale(0.98);
        }
        
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .language-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 8px 16px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .language-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: none;
        }
        
        .language-dropdown.show {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }
        
        .language-option {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .language-option:last-child {
            border-bottom: none;
        }
        
        .language-option:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        
        .language-option.active {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- 언어 선택기 -->
    <div class="language-selector">
        <button class="language-btn" onclick="toggleLanguageDropdown()">
            <i class="fas fa-globe mr-2"></i>
            <span id="currentLanguage">한국어</span>
            <i class="fas fa-chevron-down ml-2"></i>
        </button>
        <div class="language-dropdown" id="languageDropdown">
            <div class="language-option active" onclick="changeLanguage('ko')">
                <i class="fas fa-flag mr-2"></i><span data-i18n="korean">한국어</span>
            </div>
            <div class="language-option" onclick="changeLanguage('en')">
                <i class="fas fa-flag mr-2"></i><span data-i18n="english">English</span>
            </div>
            <div class="language-option" onclick="changeLanguage('es')">
                <i class="fas fa-flag mr-2"></i><span data-i18n="spanish">Español</span>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass-effect p-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <button onclick="window.location.href='index.html'" class="main-menu-btn mr-3">
                    <i class="fas fa-home text-lg"></i>
                </button>
                <button onclick="hideKeyboard()" class="main-menu-btn mr-3" title="키보드 숨김">
                    <i class="fas fa-keyboard text-lg"></i>
                </button>
                <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center mr-3">
                    <i class="fas fa-arrow-up text-white text-lg"></i>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-white" data-i18n="outbound_title">출고 작업</h1>
                    <p class="text-xs text-white/80" data-i18n="outbound_subtitle">바코드 스캔 및 출고 등록</p>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-white text-sm"></i>
                </div>
                <div class="text-white/80 text-sm" id="currentTime">00:00:00</div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="p-2 space-y-2">
        <!-- Date and Shift Selection -->
        <div class="glass-card rounded-lg p-2 animate-slide-up">
            <h2 class="text-sm font-bold text-gray-800 mb-1" data-i18n="date_shift_selection">날짜 및 차수 선택</h2>
            <div class="grid grid-cols-2 gap-2">
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1" data-i18n="date">날짜</label>
                    <input type="date" id="dateSelect" class="dropdown-select text-xs py-1">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1" data-i18n="shift">차수</label>
                    <select id="shiftSelect" class="dropdown-select text-xs py-1">
                        <option value="" data-i18n="select_shift">차수를 선택하세요</option>
                        <option value="1" data-i18n="shift_1">1차</option>
                        <option value="2" data-i18n="shift_2">2차</option>
                        <option value="3" data-i18n="shift_3">3차</option>
                        <option value="AS" data-i18n="shift_as">AS</option>
                    </select>
                </div>
            </div>
        </div>


        <!-- 바코드 스캔 섹션 (숨김 - 스캐너만 작동) -->
        <div id="scanSection" class="hidden" style="display: none;">
            <h2 class="text-sm font-bold text-gray-800 mb-1" data-i18n="barcode_scan">바코드 스캔</h2>
            <div class="space-y-1">
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1" data-i18n="part_number_scan">파트 번호 스캔</label>
                    <div class="flex space-x-1">
                        <!-- 보이지 않는 contenteditable 박스 (스캐너 전용) -->
                        <div id="barcodeInput" contenteditable="true" 
                             class="absolute opacity-0" 
                             style="position: fixed; top: -9999px; left: -9999px; width: 1px; height: 1px; outline: none; border: none;"
                             autocomplete="off"
                             spellcheck="false"
                             data-gramm="false"
                             data-gramm_editor="false"
                             data-enable-grammarly="false"
                             tabindex="-1"></div>
                        <div class="scan-input flex-1 flex items-center justify-center text-gray-500 text-xs" style="min-height: 32px;">
                            <span data-i18n="scan_barcode_placeholder">바코드를 스캔하세요</span>
                        </div>
                        <button onclick="clearScan()" class="action-button cancel-btn px-2 py-1 text-white text-xs" title="초기화">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- AS Manual Input Section (only visible for AS shift) -->
        <div id="asManualSection" class="glass-card rounded-2xl p-6 animate-slide-up hidden">
            <h2 class="text-lg font-bold text-gray-800 mb-4" data-i18n="as_manual_input">AS 수동 입력</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="select_part_manual">파트 선택</label>
                    <select id="asPartSelect" class="form-control w-full">
                        <option value="" data-i18n="select_part_manual">파트를 선택하세요</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="quantity">수량</label>
                    <input type="number" id="asQuantityInput" class="form-control w-full" 
                           data-i18n-placeholder="quantity" placeholder="수량을 입력하세요" min="1">
                </div>
                <div class="flex space-x-3">
                    <button onclick="addAsPart()" class="action-button px-6 py-3 text-white flex-1">
                        <i class="fas fa-plus mr-2"></i><span data-i18n="add">추가</span>
                    </button>
                    <button onclick="clearAsInput()" class="action-button cancel-btn px-6 py-3 text-white flex-1">
                        <i class="fas fa-times mr-2"></i><span data-i18n="clear">초기화</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Scan Progress Indicator -->
        <div id="scanProgressSection" class="glass-card rounded-2xl p-4 animate-slide-up hidden">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
                    <div>
                        <h3 class="text-base font-semibold text-blue-800" data-i18n="scanning_in_progress">스캔 진행 중...</h3>
                        <p class="text-sm text-blue-600" id="scanProgressText">바코드를 스캔하세요</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold text-blue-600" id="scannedCount">0</div>
                    <div class="text-xs text-gray-500">스캔됨</div>
                </div>
            </div>
        </div>

        <!-- Parts List -->
        <div id="partsSection" class="glass-card rounded-lg p-2 animate-slide-up hidden">
            <h2 class="text-sm font-bold text-gray-800 mb-1" data-i18n="outbound_parts_list">스캔된 파트 목록</h2>
            <div class="bg-white rounded-lg shadow-sm overflow-hidden max-h-96 overflow-y-auto">
                <table class="w-full text-xs">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-2 py-1 text-left text-xs font-medium text-gray-600" data-i18n="part_number">파트 번호</th>
                            <th class="px-2 py-1 text-center text-xs font-medium text-gray-600" data-i18n="scanned_quantity">수량</th>
                            <th class="px-2 py-1 text-center text-xs font-medium text-gray-600">CART</th>
                            <th class="px-2 py-1 text-center text-xs font-medium text-gray-600" data-i18n="status">상태</th>
                        </tr>
                    </thead>
                    <tbody id="partsList" class="divide-y divide-gray-200">
                        <!-- 파트 목록이 여기에 동적으로 추가됩니다 -->
                    </tbody>
                </table>
            </div>
        </div>


    </main>

    <!-- 하단 고정 컨펌 버튼들 -->
    <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50">
        <div id="confirmationButtons" class="hidden flex space-x-3">
            <button onclick="confirmOutbound()" 
                    class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-4 rounded-full shadow-lg flex items-center space-x-2 transition-all duration-300 transform hover:scale-105">
                <i class="fas fa-check text-lg"></i>
                <span class="font-semibold" data-i18n="confirm">확정</span>
            </button>
            <button onclick="cancelOutbound()" 
                    class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-6 py-4 rounded-full shadow-lg flex items-center space-x-2 transition-all duration-300 transform hover:scale-105">
                <i class="fas fa-times text-lg"></i>
                <span class="font-semibold" data-i18n="cancel">취소</span>
            </button>
        </div>
    </div>

    <!-- Supabase 설정 및 스크립트 -->
    <script src="../js/config.js"></script>
    <script>
        // Supabase 클라이언트 초기화
        let supabase;
        let scannedParts = {};
        let currentDate = '';
        let currentShift = '';
        let scannedUniqueCodes = new Set();
        let scanCounts = {}; // 파트별 스캔 횟수 추적
        
        function initializeSupabase() {
            try {
                console.log('=== Supabase 초기화 시작 ===');
                console.log('window.getCurrentConfig 존재 여부:', !!window.getCurrentConfig);
                console.log('window.supabase 존재 여부:', !!window.supabase);
                
                if (!window.getCurrentConfig) {
                    console.error('getCurrentConfig 함수를 찾을 수 없습니다. config.js가 로드되었는지 확인하세요.');
                    console.log('window 객체 확인:', Object.keys(window).filter(key => key.includes('config')));
                    return false;
                }
                
                const config = window.getCurrentConfig();
                console.log('설정 로드됨:', config);
                console.log('config.url:', config.url);
                console.log('config.anonKey 길이:', config.anonKey ? config.anonKey.length : 'undefined');
                
                if (!window.supabase) {
                    console.error('Supabase 라이브러리가 로드되지 않았습니다.');
                    console.log('window 객체 확인:', Object.keys(window).filter(key => key.includes('supabase')));
                    return false;
                }
                
                console.log('Supabase 클라이언트 생성 시작...');
                supabase = window.supabase.createClient(config.url, config.anonKey);
                console.log('Supabase 클라이언트 초기화 성공');
                console.log('supabase 객체:', supabase);
                return true;
            } catch (error) {
                console.error('Supabase 클라이언트 초기화 실패:', error);
                console.error('오류 상세:', error.message, error.stack);
                return false;
            }
        }

        // 날짜 및 차수 선택 시 정보 업데이트
        function updateOutboundInfo() {
            const date = document.getElementById('dateSelect').value;
            const shift = document.getElementById('shiftSelect').value;
            
            console.log('updateOutboundInfo 호출됨:', { date, shift });
            
            currentDate = date;
            currentShift = shift;
            
            if (date && shift) {
                console.log('날짜와 차수가 모두 선택됨, 화면 업데이트 시작');
                
                // select에서 즉시 포커스 제거 (키보드 방지)
                const dateSelect = document.getElementById('dateSelect');
                const shiftSelect = document.getElementById('shiftSelect');
                if (dateSelect) dateSelect.blur();
                if (shiftSelect) shiftSelect.blur();
                
                // 전역 바코드 스캔 활성화
                isGlobalBarcodeEnabled = true;
                console.log('전역 바코드 스캔 활성화됨');
                
                // 전역 바코드 상태 표시
                showGlobalBarcodeStatus();
                
                // 차수 선택 후 포커스 제어 적용
                setTimeout(preventInputFocus, 100);
                
                // AS 차수인지 확인
                if (shift === 'AS') {
                    console.log('AS 차수 선택됨');
                    showAsManualSection();
                    loadMasterParts(); // 마스터 파트 목록 로드
                    // AS 차수일 때는 기존 출고 데이터를 로드하지 않음
                    scannedParts = {};
                } else {
                    console.log('일반 차수 선택됨:', shift);
                    hideAsManualSection();
                    // 다른 차수일 때는 기존 출고 데이터 로드 (비동기)
                    loadOutboundParts().then(() => {
                        console.log('출고 파트 로드 완료');
                        // 파트 목록 렌더링
                        renderPartsList();
                    }).catch(error => {
                        console.error('출고 파트 로드 오류:', error);
                    });
                }
                
                // 바코드 스캔 섹션은 숨김 상태 유지, 파트 섹션만 표시
                document.getElementById('partsSection').classList.remove('hidden');
                
                // 바코드 입력 필드 설정 및 포커스 (select blur 후)
                setTimeout(() => {
                    // select에서 포커스 제거
                    const dateSelect = document.getElementById('dateSelect');
                    const shiftSelect = document.getElementById('shiftSelect');
                    if (dateSelect) dateSelect.blur();
                    if (shiftSelect) shiftSelect.blur();
                    // 바코드 입력 필드 설정 (이벤트 리스너 등록)
                    setupBarcodeInput();
                    // 바코드 입력 필드에 포커스
                    const barcodeInput = document.getElementById('barcodeInput');
                    if (barcodeInput) {
                        barcodeInput.focus();
                        console.log('차수 선택 후 바코드 입력 필드 포커스 및 설정 완료 (출고)');
                    }
                }, 500);
                
                console.log('화면 업데이트 완료');
            } else {
                console.log('날짜 또는 차수가 선택되지 않음, 화면 숨김');
                document.getElementById('partsSection').classList.add('hidden');
                document.getElementById('confirmationButtons').classList.add('hidden');
                hideAsManualSection();
            }
        }

        // 파트 목록 렌더링
        function renderPartsList() {
            const partsList = document.getElementById('partsList');
            partsList.innerHTML = '';

            Object.keys(scannedParts).forEach(partNumber => {
                const part = scannedParts[partNumber];
                const partItem = document.createElement('tr');
                partItem.className = 'hover:bg-gray-50 transition-colors duration-200';
                partItem.id = `part-${partNumber}`;
                
                // 출고 등록에서는 스캔된 수량이 0보다 크면 완료로 간주
                const isCompleted = part.scannedQuantity > 0;

                // 스캔된 파트는 빨간색 배경
                if (isCompleted) {
                    partItem.classList.add('bg-red-100', 'border-l-4', 'border-red-500');
                }

                partItem.innerHTML = `
                    <td class="px-2 py-1">
                        <div>
                            <div class="text-xs font-bold text-gray-800">${partNumber}</div>
                            <div class="text-xs text-gray-500">${part.category || 'N/A'}</div>
                        </div>
                    </td>
                    <td class="px-2 py-1 text-center">
                        <span class="text-xs font-bold ${part.scannedQuantity > 0 ? 'text-red-600' : 'text-gray-500'}">${part.scannedQuantity}</span>
                    </td>
                    <td class="px-2 py-1 text-center">
                        <span class="text-xs font-bold ${part.scanCount > 0 ? 'text-blue-600' : 'text-gray-500'}">${part.scanCount || 0}</span>
                    </td>
                    <td class="px-2 py-1 text-center">
                        <span class="text-xs font-bold ${part.scannedQuantity > 0 ? 'text-red-600' : 'text-gray-500'}">
                            ${part.scannedQuantity > 0 ? '✓' : '⏳'}
                        </span>
                    </td>
                `;

                partsList.appendChild(partItem);
            });
        }

        // 진행 상황 업데이트
        function updateProgress() {
            const completedParts = Object.values(scannedParts).filter(part => part.scannedQuantity > 0).length;
            const totalParts = Object.keys(scannedParts).length;

            // 스캔된 파트 수 업데이트
            document.getElementById('scannedCount').textContent = completedParts;

            if (completedParts > 0) {
                // 스캔 진행 중 인디케이터 표시
                document.getElementById('scanProgressSection').classList.remove('hidden');
                
                // 진행 상황 텍스트 업데이트
                const progressText = document.getElementById('scanProgressText');
                if (totalParts > 0) {
                    progressText.textContent = `${completedParts}/${totalParts} 항목 스캔됨`;
                } else {
                    progressText.textContent = `${completedParts} 항목 스캔됨`;
                }

                // 모든 항목이 스캔 완료되었을 때만 컨펌 버튼 표시
                if (completedParts === totalParts && totalParts > 0) {
                    document.getElementById('confirmationButtons').classList.remove('hidden');
                    document.getElementById('scanProgressSection').classList.add('hidden');
                } else {
                    document.getElementById('confirmationButtons').classList.add('hidden');
                }
            } else {
                // 스캔된 항목이 없으면 모든 인디케이터 숨김
                document.getElementById('scanProgressSection').classList.add('hidden');
                document.getElementById('confirmationButtons').classList.add('hidden');
            }
        }

        // 바코드 스캔 처리
        function handleBarcodeScan(barcode) {
            console.log('바코드 스캔 처리 시작:', barcode);
            console.log('현재 스캔된 파트 목록:', Object.keys(scannedParts));
            
            // GS1-128 바코드 파싱 시도
            const parsedData = parseGS1Barcode(barcode);
            
            if (parsedData) {
                console.log('GS1-128 파싱 성공, 파트 번호:', parsedData.partNumber);
                console.log('추출된 고유코드:', parsedData.uniqueNumber);
                
                // 고유코드 중복 검사
                if (scannedUniqueCodes.has(parsedData.uniqueNumber)) {
                    console.log('고유코드 중복 감지:', parsedData.uniqueNumber);
                    
                    // 바코드 입력창에 시각적 피드백 제공
                    const barcodeInput = document.getElementById('barcodeInput');
                    barcodeInput.style.backgroundColor = '#fee2e2'; // 빨간색 배경
                    barcodeInput.style.borderColor = '#ef4444'; // 빨간색 테두리
                    // contenteditable은 placeholder를 지원하지 않음
                    
                    // 1.5초 후 원래 상태로 복원
                    setTimeout(() => {
                        barcodeInput.style.backgroundColor = '';
                        barcodeInput.style.borderColor = '';
                        // contenteditable은 placeholder를 지원하지 않음
                        setBarcodeValue('');
                        barcodeInput.focus();
                    }, 1500);
                    
                    return false;
                }
                
                // 파트가 이미 스캔된 목록에 있는지 확인
                let part = scannedParts[parsedData.partNumber];
                
                if (!part) {
                    // 새로운 파트인 경우 추가
                    console.log('새로운 파트 추가:', parsedData.partNumber);
                    scannedParts[parsedData.partNumber] = {
                        partNumber: parsedData.partNumber,
                        quantity: parsedData.quantity,
                        scannedQuantity: 0,
                        scanCount: 0, // 스캔 횟수 추가
                        category: '출고 파트'
                    };
                    part = scannedParts[parsedData.partNumber];
                    scanCounts[parsedData.partNumber] = 0; // 스캔 횟수 초기화
                }
                
                // 고유코드를 스캔된 목록에 추가
                scannedUniqueCodes.add(parsedData.uniqueNumber);
                console.log('고유코드 등록됨:', parsedData.uniqueNumber);
                console.log('현재 스캔된 고유코드 목록:', Array.from(scannedUniqueCodes));
                
                // 스캔된 수량을 해당 파트에 추가
                part.scannedQuantity += parsedData.quantity;
                // 스캔 횟수 증가 (바코드 QTY와 관계없이 1회씩 증가)
                part.scanCount += 1;
                scanCounts[parsedData.partNumber] = part.scanCount;
                
                renderPartsList();
                updateProgress();
                
                // 스캔 성공 토스트 표시
                const scanMessage = parsedData.uniqueNumber 
                    ? `✅ 스캔 성공: ${parsedData.partNumber} (수량: ${parsedData.quantity}, 고유코드: ${parsedData.uniqueNumber})`
                    : `✅ 스캔 성공: ${parsedData.partNumber} (수량: ${parsedData.quantity})`;
                showNotification(scanMessage, 'success');
                
                // 입력 필드 초기화 및 포커스 유지
                const barcodeInput = document.getElementById('barcodeInput');
                setBarcodeValue('');
                setTimeout(() => {
                    barcodeInput.focus();
                }, 100);
                
                return true;
            } else {
                console.log('GS1-128 파싱 실패, 직접 파트 번호 입력 시도');
                
                // 직접 파트 번호 입력인 경우 - 파트 번호 정리 (관리자 모드와 동일)
                let cleanPartNumber = barcode.trim();
                
                // 유효한 파트 번호 형식인지 확인 (최소 5자리 이상이어야 함)
                if (cleanPartNumber.length < 5) {
                    console.log('파트 번호가 너무 짧음:', cleanPartNumber);
                    showNotification('유효하지 않은 바코드입니다. 올바른 바코드를 스캔하세요.', 'error');
                    return false;
                }
                
                // P 접두사가 있으면 제거
                if (cleanPartNumber.startsWith('P')) {
                    cleanPartNumber = cleanPartNumber.substring(1);
                    console.log('P 접두사 제거 후:', cleanPartNumber);
                }
                
                // 5자리 숫자 + 알파벳 + 4자리 숫자 형식인지 확인
                const partMatch = cleanPartNumber.match(/^(\d{5})([A-Za-z])(\d{4})$/);
                if (partMatch) {
                    // 하이픈 추가
                    cleanPartNumber = `${partMatch[1]}-${partMatch[2]}${partMatch[3]}`;
                    console.log('파트 번호 정리됨:', barcode, '->', cleanPartNumber);
                } else {
                    // 유효한 파트 번호 형식이 아닌 경우
                    console.log('유효하지 않은 파트 번호 형식:', cleanPartNumber);
                    showNotification('유효하지 않은 바코드 형식입니다. 올바른 바코드를 스캔하세요.', 'error');
                    return false;
                }
                
                let part = scannedParts[cleanPartNumber];
                
                if (!part) {
                    // 새로운 파트인 경우 추가
                    console.log('새로운 파트 추가 (직접 입력):', cleanPartNumber);
                    scannedParts[cleanPartNumber] = {
                        partNumber: cleanPartNumber,
                        quantity: 1,
                        scannedQuantity: 0,
                        scanCount: 0, // 스캔 횟수 추가
                        category: '출고 파트'
                    };
                    part = scannedParts[cleanPartNumber];
                    scanCounts[cleanPartNumber] = 0; // 스캔 횟수 초기화
                }
                
                // 스캔된 수량을 해당 파트에 추가 (수량 1)
                part.scannedQuantity += 1;
                // 스캔 횟수 증가 (직접 입력도 1회씩 증가)
                part.scanCount += 1;
                scanCounts[cleanPartNumber] = part.scanCount;
                
                renderPartsList();
                updateProgress();
                
                // 스캔 성공 토스트 표시
                showNotification(`✅ 스캔 성공: ${cleanPartNumber} (수량: 1, 바코드: ${barcode.substring(0, 20)}...)`, 'success');
                
                // 입력 필드 초기화 및 포커스 유지
                const barcodeInput = document.getElementById('barcodeInput');
                setBarcodeValue('');
                setTimeout(() => {
                    barcodeInput.focus();
                }, 100);
                
                return true;
            }
        }

        // GS1-128 바코드 파싱 함수 (출고 작업 라벨 형식 지원)
        function parseGS1Barcode(barcode) {
            try {
                console.log('출고 바코드 파싱 시작:', barcode);
                console.log('바코드 길이:', barcode.length);
                
                // ===== 형식 1: GS1-128 표준 형식 (출고 라벨) =====
                // [)>*06:D032125:5K:23L:24L:P49560l3010:7Q50:3SP11000321253583:VP1100*EOT
                // [)>*06:D082225:5K:23L:24L:P49560CW150:7Q80:3SP1100082225460:VP1100*EOT
                if (barcode.includes('[)>*06:') || barcode.includes('*EOT')) {
                    console.log('GS1-128 표준 형식 감지 (출고 라벨)');
                    
                    // 파트 번호 추출 - 다양한 형식 지원
                    // P49560L3010 (5자리 숫자 + 알파벳 1개 + 4자리 숫자)
                    // P49560CW150 (5자리 숫자 + 알파벳 2개 + 3자리 숫자)
                    // P49560l3010 (소문자 포함)
                    const partMatch = barcode.match(/P\d{5}[a-zA-Z]+\d{3,4}/);
                    if (!partMatch) {
                        console.log('GS1-128 파트 번호 매칭 실패 - 바코드:', barcode);
                        console.log('P로 시작하는 부분들:', barcode.match(/P[^:]*/g));
                        return null;
                    }
                    let partNumber = partMatch[0];
                    console.log('추출된 파트 번호 (P 포함):', partNumber);
                    
                    // P 접두사 제거 (P49560CW150 -> 49560CW150)
                    if (partNumber.startsWith('P')) {
                        partNumber = partNumber.substring(1);
                        console.log('P 접두사 제거 후:', partNumber);
                    }
                    
                    // DB 형식에 맞게 하이픈 추가
                    // 49560L3010 -> 49560-L3010 (알파벳 1개 + 숫자 4자리)
                    // 49560CW150 -> 49560-CW150 (알파벳 2개 + 숫자 3자리)
                    // 49560l3010 -> 49560-L3010 (소문자 포함)
                    const hyphenMatch1 = partNumber.match(/^(\d{5})([A-Za-z])(\d{4})$/); // 알파벳 1개 + 숫자 4자리
                    const hyphenMatch2 = partNumber.match(/^(\d{5})([A-Za-z]{2})(\d{3})$/); // 알파벳 2개 + 숫자 3자리
                    const hyphenMatch3 = partNumber.match(/^(\d{5})([A-Za-z]+)(\d{3,4})$/); // 일반적인 경우
                    
                    if (hyphenMatch1) {
                        partNumber = `${hyphenMatch1[1]}-${hyphenMatch1[2]}${hyphenMatch1[3]}`;
                        console.log('하이픈 추가 후 (패턴1):', partNumber);
                    } else if (hyphenMatch2) {
                        partNumber = `${hyphenMatch2[1]}-${hyphenMatch2[2]}${hyphenMatch2[3]}`;
                        console.log('하이픈 추가 후 (패턴2):', partNumber);
                    } else if (hyphenMatch3) {
                        // 알파벳과 숫자 사이에 하이픈 추가
                        const letters = hyphenMatch3[2].toUpperCase(); // 소문자를 대문자로 변환
                        partNumber = `${hyphenMatch3[1]}-${letters}${hyphenMatch3[3]}`;
                        console.log('하이픈 추가 후 (패턴3):', partNumber);
                    }
                    
                    // 수량 추출 (7Q50 -> 50)
                    const quantityMatch = barcode.match(/7Q(\d+)/);
                    if (!quantityMatch) {
                        console.log('GS1-128 수량 매칭 실패');
                        return null;
                    }
                    const quantity = parseInt(quantityMatch[1]);
                    console.log('추출된 수량:', quantity);
                    
                    // 유니크 넘버 추출 (3SP11000321253583 -> P11000321253583 또는 3SP11000321253583)
                    // 패턴 1: 3SP로 시작하는 경우 (3SP11000321253583)
                    let uniqueMatch = barcode.match(/3SP([^:*]+)/);
                    let uniqueNumber = null;
                    
                    if (uniqueMatch) {
                        // P 접두사 포함하여 저장 (P11000321253583)
                        uniqueNumber = 'P' + uniqueMatch[1];
                        console.log('추출된 유니크 넘버 (패턴1):', uniqueNumber);
                    } else {
                        // 패턴 2: 3S로 시작하는 경우 (3S 뒤의 값)
                        uniqueMatch = barcode.match(/3S([^:*]+)/);
                        if (uniqueMatch) {
                            uniqueNumber = uniqueMatch[1];
                            console.log('추출된 유니크 넘버 (패턴2):', uniqueNumber);
                        } else {
                            console.log('GS1-128 유니크 넘버 매칭 실패, 전체 바코드를 고유코드로 사용');
                            // 고유코드가 없으면 전체 바코드를 고유코드로 사용
                            uniqueNumber = barcode;
                        }
                    }
                    
                    return {
                        partNumber,
                        quantity,
                        uniqueNumber
                    };
                }
                
                // ===== 형식 2: QR 코드 또는 라벨 텍스트 형식 (출고 라벨) =====
                // 예: "49601-S9000:80:P1100082225460" 또는 "Part:49601-S9000 Qty:80 Tag:P1100082225460"
                console.log('GS1-128 표준 형식 아님, 라벨 텍스트 형식 시도 (출고 라벨)');
                
                // 패턴 1: "파트번호:수량:태그번호" 형식
                const pattern1 = barcode.match(/^(\d{5}-[A-Za-z]+\d{3,4}):(\d+):(P\d+)$/);
                if (pattern1) {
                    console.log('패턴 1 매칭 성공:', pattern1);
                    return {
                        partNumber: pattern1[1], // 49601-S9000
                        quantity: parseInt(pattern1[2]), // 80
                        uniqueNumber: pattern1[3] // P1100082225460
                    };
                }
                
                // 패턴 2: "파트번호:수량" 형식 (태그번호 없음)
                const pattern2 = barcode.match(/^(\d{5}-[A-Za-z]+\d{3,4}):(\d+)$/);
                if (pattern2) {
                    console.log('패턴 2 매칭 성공:', pattern2);
                    return {
                        partNumber: pattern2[1], // 49601-S9000
                        quantity: parseInt(pattern2[2]), // 80
                        uniqueNumber: null // 태그번호 없음
                    };
                }
                
                // 패턴 3: 하이픈 포함 파트 번호만 (수량 1, 태그번호 없음)
                const pattern3 = barcode.match(/^(\d{5}-[A-Za-z]+\d{3,4})$/);
                if (pattern3) {
                    console.log('패턴 3 매칭 성공 (파트 번호만):', pattern3);
                    return {
                        partNumber: pattern3[1], // 49601-S9000
                        quantity: 1, // 기본값
                        uniqueNumber: null
                    };
                }
                
                // 패턴 4: "Part:49601-S9000 Qty:80 Tag:P1100082225460" 형식
                const partMatch4 = barcode.match(/Part[:\s]+(\d{5}-[A-Za-z]+\d{3,4})/i);
                const qtyMatch4 = barcode.match(/Qty[:\s]+(\d+)/i);
                const tagMatch4 = barcode.match(/Tag[:\s]+(P\d+)/i);
                
                if (partMatch4) {
                    console.log('패턴 4 매칭 성공:', { part: partMatch4[1], qty: qtyMatch4?.[1], tag: tagMatch4?.[1] });
                    return {
                        partNumber: partMatch4[1],
                        quantity: qtyMatch4 ? parseInt(qtyMatch4[1]) : 1,
                        uniqueNumber: tagMatch4 ? tagMatch4[1] : null
                    };
                }
                
                // 패턴 5: QR 코드가 여러 줄로 나뉘어 있는 경우
                // "49601-S9000\n80\nP1100082225460" 형식
                const lines = barcode.split('\n').map(l => l.trim()).filter(l => l);
                if (lines.length >= 2) {
                    const partLine = lines.find(l => /^\d{5}-[A-Za-z]+\d{3,4}$/.test(l));
                    const qtyLine = lines.find(l => /^\d+$/.test(l));
                    const tagLine = lines.find(l => /^P\d+$/.test(l));
                    
                    if (partLine) {
                        console.log('패턴 5 매칭 성공 (여러 줄):', { part: partLine, qty: qtyLine, tag: tagLine });
                        return {
                            partNumber: partLine,
                            quantity: qtyLine ? parseInt(qtyLine) : 1,
                            uniqueNumber: tagLine || null
                        };
                    }
                }
                
                console.log('모든 패턴 매칭 실패 - 바코드:', barcode);
                return null;
                
            } catch (error) {
                console.error('GS1 바코드 파싱 오류:', error);
                return null;
            }
        }

        // 바코드 스캔 시뮬레이션
        function scanBarcode() {
            const barcode = getBarcodeValue();
            
            if (barcode) {
                handleBarcodeScan(barcode);
                setBarcodeValue(''); // 스캔 후 초기화
                const barcodeInput = document.getElementById('barcodeInput');
                if (barcodeInput) {
                    setTimeout(() => barcodeInput.focus(), 100);
                }
            } else {
                showNotification('바코드를 입력하거나 스캔하세요.', 'warning');
            }
        }

        // 스캔 초기화
        function clearScan() {
            // 모든 데이터 초기화
            scannedParts = {}; // 파트 목록 전체 초기화
            scannedUniqueCodes.clear(); // 고유코드 목록 초기화
            scanCounts = {}; // 스캔 횟수 초기화
            
            // UI 초기화
            renderPartsList();
            updateProgress();
            setBarcodeValue('');
            
            // 진행 상황 및 확인 버튼 숨기기
            document.getElementById('scanProgressSection').classList.add('hidden');
            document.getElementById('confirmationButtons').classList.add('hidden');
            
            showNotification('스캔이 초기화되었습니다.', 'info');
        }

        // 출고 확정 (관리자 모드와 동일한 방식으로 PENDING 상태로 등록)
        async function confirmOutbound() {
            console.log('=== PDA 출고 등록 함수 시작 ===');
            console.log('currentDate:', currentDate);
            console.log('currentShift:', currentShift);
            console.log('scannedParts:', scannedParts);
            
            if (!currentDate || !currentShift) {
                console.error('날짜와 차수가 선택되지 않음');
                showNotification('날짜와 차수를 선택해주세요.', 'error');
                return;
            }

            // 스캔된 파트가 있는지 확인
            const hasScannedParts = Object.values(scannedParts).some(part => part.scannedQuantity > 0);
            console.log('hasScannedParts:', hasScannedParts);
            console.log('파트별 스캔 상태:', Object.entries(scannedParts).map(([partNum, part]) => ({part: partNum, scanned: part.scannedQuantity, quantity: part.quantity})));
            
            if (!hasScannedParts) {
                console.error('스캔된 파트가 없음');
                showNotification('스캔된 파트가 없습니다. 바코드를 스캔해주세요.', 'error');
                return;
            }

            try {
                console.log('PDA 출고 등록 시작:', currentDate, currentShift);
                
                // 0. 동일한 날짜와 차수의 중복 확인 (관리자 모드와 동일)
                const sequenceNumber = `${currentDate.replace(/-/g, '')}-${currentShift}`;
                const { data: existingSequence, error: checkError } = await supabase
                    .from('outbound_sequences')
                    .select('id, sequence_number, outbound_date, status')
                    .eq('outbound_date', currentDate)
                    .eq('sequence_number', sequenceNumber)
                    .maybeSingle();

                if (checkError) {
                    console.error('중복 확인 오류:', checkError);
                    throw checkError;
                }

                if (existingSequence) {
                    showNotification(`이미 등록된 차수입니다: ${existingSequence.sequence_number}`, 'error');
                    return;
                }
                
                // 1. 출고 차수 생성 (관리자 모드와 동일한 형식)
                const sequenceData = {
                    sequence_number: sequenceNumber,
                    outbound_date: currentDate,
                    status: 'PENDING'
                };

                console.log('출고 차수 데이터:', sequenceData);
                const { data: newSequence, error: sequenceError } = await supabase
                    .from('outbound_sequences')
                    .insert(sequenceData)
                    .select()
                    .single();

                if (sequenceError) {
                    console.error('출고 차수 생성 오류:', sequenceError);
                    showNotification(`출고 차수 생성 오류: ${sequenceError.message}`, 'error');
                    throw sequenceError;
                }

                console.log('출고 차수 생성 성공:', newSequence);

                // 2. 출고 파트들 생성 (관리자 모드와 동일한 형식)
                const partsData = Object.entries(scannedParts)
                    .filter(([partNumber, part]) => part.scannedQuantity > 0) // 스캔된 파트만 저장
                    .map(([partNumber, part]) => ({
                        sequence_id: newSequence.id,
                        part_number: partNumber,
                        planned_qty: currentShift === 'AS' ? 0 : (part.quantity || 0), // AS는 계획 수량 0
                        scanned_qty: part.scannedQuantity, // 실제 스캔된 수량
                        actual_qty: part.scannedQuantity, // PDA에서는 스캔된 수량 = 실제 출고 수량
                        status: 'PENDING'
                    }));

                console.log('출고 파트 데이터:', partsData);
                const { error: partsError } = await supabase
                    .from('outbound_parts')
                    .insert(partsData);

                if (partsError) {
                    console.error('출고 파트 생성 오류:', partsError);
                    showNotification(`출고 파트 생성 오류: ${partsError.message}`, 'error');
                    throw partsError;
                }

                console.log('출고 파트 생성 성공');

                const totalScannedQuantity = Object.values(scannedParts).reduce((sum, part) => sum + part.scannedQuantity, 0);
                console.log('PDA 출고 등록 완료:', {
                    sequenceId: newSequence.id,
                    sequenceNumber: sequenceNumber,
                    date: currentDate,
                    shift: currentShift,
                    totalScannedQuantity,
                    partsCount: partsData.length
                });
                showNotification(`출고가 성공적으로 등록되었습니다. (${sequenceNumber}, 총 스캔 수량: ${totalScannedQuantity})`, 'success');
                
                // 페이지 초기화
                setTimeout(() => {
                    resetPage();
                }, 2000);

            } catch (error) {
                console.error('PDA 출고 등록 오류:', error);
                showNotification(`출고 등록 중 오류가 발생했습니다: ${error.message}`, 'error');
            }
        }

        // 출고 취소
        function cancelOutbound() {
            // 모든 데이터 초기화 (초기화 버튼과 동일)
            scannedParts = {}; // 파트 목록 전체 초기화
            scannedUniqueCodes.clear(); // 고유코드 목록 초기화
            scanCounts = {}; // 스캔 횟수 초기화
            
            // UI 초기화
            renderPartsList();
            updateProgress();
            setBarcodeValue('');
            document.getElementById('confirmationSection').classList.add('hidden');
            
            showNotification('출고가 취소되었습니다.', 'info');
        }

        // 페이지 초기화
        function resetPage() {
            scannedParts = {};
            scannedUniqueCodes.clear();
            scanCounts = {}; // 스캔 횟수 초기화
            
            document.getElementById('dateSelect').value = '';
            document.getElementById('shiftSelect').value = '';
            document.getElementById('partsSection').classList.add('hidden');
            document.getElementById('scanProgressSection').classList.add('hidden');
            document.getElementById('confirmationButtons').classList.add('hidden');
            document.getElementById('partsList').innerHTML = '';
            
            currentDate = '';
            currentShift = '';
        }

        // 알림 표시
        function showNotification(message, type = 'info') {
            // 간단한 알림 구현
            alert(message);
        }

        // 현재 시간 업데이트
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'America/Chicago'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        // 전역 바코드 입력 버퍼
        let globalBarcodeBuffer = '';
        let globalBarcodeTimer = null;
        const BARCODE_TIMEOUT = 100; // 바코드 입력 완료 판단 시간 (ms)
        
        // 바코드 패턴 확인 및 자동 스캔 함수
        function checkAndAutoScan(value) {
            if (!value || !value.trim().length === 0) {
                return;
            }
            
            // 타이머 리셋 (연속 입력 중)
            if (globalBarcodeTimer) {
                clearTimeout(globalBarcodeTimer);
            }
            
            // GS1-128 바코드 패턴 확인
            const isGS1BarcodePattern = /^\[\)>\*06:.*P\d{5}[a-zA-Z]+\d{3,4}.*7Q\d+.*3S[^:]+.*\*EOT$/.test(value);
            
            // 바코드 길이가 30자 이상이거나 GS1 패턴이 맞으면 자동 스캔
            if (value.length >= 30 || (value.length >= 20 && isGS1BarcodePattern)) {
                globalBarcodeTimer = setTimeout(() => {
                    console.log('바코드 입력 완료 (자동):', value);
                    scanBarcode();
                }, 100);
            } else {
                // 일정 시간 입력이 없으면 자동으로 처리
                globalBarcodeTimer = setTimeout(() => {
                    if (value.trim().length > 0) {
                        console.log('바코드 입력 완료 (타이머):', value);
                        scanBarcode();
                    }
                }, BARCODE_TIMEOUT);
            }
        }
        let isGlobalBarcodeEnabled = false; // 차수 선택 후에만 활성화

        // 전역 바코드 입력 상태 표시
        function showGlobalBarcodeStatus() {
            // 전역 바코드가 비활성화된 경우 표시하지 않음
            if (!isGlobalBarcodeEnabled) {
                return;
            }
            
            // 상태 표시 요소 생성
            const statusElement = document.createElement('div');
            statusElement.id = 'globalBarcodeStatus';
            statusElement.className = 'fixed top-20 right-4 bg-green-100 border border-green-400 text-green-700 px-3 py-2 rounded-lg text-sm z-50';
            statusElement.innerHTML = '<i class="fas fa-barcode mr-2"></i>전역 바코드 스캔 활성화';
            document.body.appendChild(statusElement);
            
            // 3초 후 자동 숨김
            setTimeout(() => {
                if (statusElement) {
                    statusElement.style.opacity = '0.5';
                }
            }, 3000);
        }

        // 바코드 입력 중 시각적 피드백
        function showBarcodeInputFeedback() {
            const barcodeInput = document.getElementById('barcodeInput');
            if (barcodeInput) {
                // 입력창에 시각적 피드백 제공
                barcodeInput.style.backgroundColor = '#fef3c7'; // 노란색 배경
                barcodeInput.style.borderColor = '#f59e0b'; // 주황색 테두리
                
                // 0.5초 후 원래 상태로 복원
                setTimeout(() => {
                    barcodeInput.style.backgroundColor = '';
                    barcodeInput.style.borderColor = '';
                }, 500);
            }
        }

        // 출고 파트 목록 로드 함수
        async function loadOutboundParts() {
            try {
                const selectedShift = document.getElementById('shiftSelect').value;
                const selectedDate = document.getElementById('dateSelect').value;
                console.log('출고 파트 로드 시작, 선택된 차수:', selectedShift, '날짜:', selectedDate);
                
                if (!selectedShift || selectedShift === 'AS') {
                    console.log('AS 차수이거나 차수가 선택되지 않음 - 출고 파트 로드 안함');
                    return Promise.resolve();
                }

                if (!selectedDate) {
                    console.log('날짜가 선택되지 않음 - 출고 파트 로드 안함');
                    return Promise.resolve();
                }

                // sequence_number 형식: YYYYMMDD-차수 (예: 20251110-1)
                const sequenceNumber = `${selectedDate.replace(/-/g, '')}-${selectedShift}`;
                console.log('조회할 sequence_number:', sequenceNumber);

                // 선택된 차수에 해당하는 출고 시퀀스 찾기
                const { data: sequences, error: sequencesError } = await supabase
                    .from('outbound_sequences')
                    .select('id, sequence_number, outbound_date')
                    .eq('sequence_number', sequenceNumber)
                    .eq('status', 'PENDING')
                    .order('created_at', { ascending: false });

                if (sequencesError) {
                    console.error('출고 시퀀스 조회 오류:', sequencesError);
                    throw sequencesError;
                }

                if (!sequences || sequences.length === 0) {
                    console.log('해당 차수의 출고 시퀀스가 없음');
                    return Promise.resolve();
                }

                const sequenceId = sequences[0].id;
                console.log('출고 시퀀스 ID:', sequenceId);

                // 해당 시퀀스의 출고 파트 목록 조회
                const { data: outboundParts, error: partsError } = await supabase
                    .from('outbound_parts')
                    .select(`
                        id,
                        part_number,
                        planned_qty,
                        actual_qty,
                        scanned_qty,
                        status,
                        parts (
                            description,
                            category
                        )
                    `)
                    .eq('sequence_id', sequenceId)
                    .order('created_at', { ascending: true });

                if (partsError) {
                    console.error('출고 파트 조회 오류:', partsError);
                    throw partsError;
                }

                console.log('출고 파트 목록 로드 완료:', outboundParts);
                
                // 전역 변수에 저장
                window.outboundParts = outboundParts || [];
                
                return Promise.resolve();
            } catch (error) {
                console.error('출고 파트 로드 중 오류:', error);
                return Promise.reject(error);
            }
        }

        // 전역 바코드 입력 처리 함수
        function handleGlobalBarcodeInput(e) {
            // 전역 바코드가 비활성화된 경우 무시
            if (!isGlobalBarcodeEnabled) {
                return;
            }
            
            // 특수 키는 무시 (Shift, Ctrl, Alt, Tab, Escape 등)
            if (e.key.length > 1 && !['Enter', 'Backspace'].includes(e.key)) {
                return;
            }

            // Enter 키로 바코드 입력 완료
            if (e.key === 'Enter') {
                e.preventDefault();
                
                if (globalBarcodeBuffer.trim().length > 0) {
                    console.log('전역 바코드 입력 완료:', globalBarcodeBuffer);
                    
                    // 바코드 입력창에 값 설정하고 스캔 실행
                    const barcodeInput = document.getElementById('barcodeInput');
                    if (barcodeInput) {
                        setBarcodeValue(globalBarcodeBuffer);
                        scanBarcode();
                    }
                    
                    // 버퍼 초기화
                    globalBarcodeBuffer = '';
                }
                return;
            }

            // Backspace 키 처리
            if (e.key === 'Backspace') {
                e.preventDefault();
                globalBarcodeBuffer = globalBarcodeBuffer.slice(0, -1);
                return;
            }

            // 일반 문자 입력
            if (e.key.length === 1) {
                e.preventDefault();
                globalBarcodeBuffer += e.key;
                
                // 바코드 입력 중 시각적 피드백
                showBarcodeInputFeedback();
                
                // 타이머 리셋 (연속 입력 중)
                if (globalBarcodeTimer) {
                    clearTimeout(globalBarcodeTimer);
                }
                
                // GS1-128 바코드 패턴 확인 (정확한 패턴)
                const isGS1BarcodePattern = /^\[\)>\*06:D\d+:5K:23L:24L:P\d{5}[a-zA-Z]\d{4}:7Q\d+:3S[^:]+:VP\d+\*EOT$/.test(globalBarcodeBuffer);
                
                // 바코드 길이가 30자 이상이거나 GS1 패턴이 맞으면 자동 엔터
                if (globalBarcodeBuffer.length >= 30 || (globalBarcodeBuffer.length >= 20 && isGS1BarcodePattern)) {
                    globalBarcodeTimer = setTimeout(() => {
                        // 엔터키 이벤트 시뮬레이션
                        const enterEvent = new KeyboardEvent('keydown', {
                            key: 'Enter',
                            code: 'Enter',
                            keyCode: 13,
                            which: 13,
                            bubbles: true,
                            cancelable: true
                        });
                        document.dispatchEvent(enterEvent);
                    }, 50);
                } else {
                    // 일반적인 경우 타이머 설정
                    globalBarcodeTimer = setTimeout(() => {
                        if (globalBarcodeBuffer.trim().length > 0) {
                            console.log('전역 바코드 입력 완료 (타이머):', globalBarcodeBuffer);
                            
                            // 바코드 입력창에 값 설정하고 스캔 실행
                            const barcodeInput = document.getElementById('barcodeInput');
                            if (barcodeInput) {
                                setBarcodeValue(globalBarcodeBuffer);
                                scanBarcode();
                            }
                            
                            // 버퍼 초기화
                            globalBarcodeBuffer = '';
                        }
                    }, BARCODE_TIMEOUT);
                }
            }
        }

        // 이벤트 리스너 설정
        function setupEventListeners() {
            // 날짜 및 차수 선택 이벤트
            const dateSelect = document.getElementById('dateSelect');
            const shiftSelect = document.getElementById('shiftSelect');
            
            dateSelect.addEventListener('change', function(e) {
                // select에서 즉시 포커스 제거 (키보드 방지)
                this.blur();
                updateOutboundInfo();
            });
            
            shiftSelect.addEventListener('change', function(e) {
                // select에서 즉시 포커스 제거 (키보드 방지)
                this.blur();
                updateOutboundInfo();
            });

            // 전역 키보드 이벤트 리스너 (바코드 스캐너용) - 항상 활성화
            document.addEventListener('keydown', function(e) {
                // 날짜/차수 선택 드롭다운이나 버튼에 포커스가 있으면 무시
                const activeElement = document.activeElement;
                if (activeElement && (
                    activeElement.id === 'dateSelect' ||
                    activeElement.id === 'shiftSelect' ||
                    activeElement.closest('button')
                )) {
                    return;
                }
                
                // 파트 섹션이 보일 때만 전역 바코드 입력 처리 (스캔 섹션은 숨김)
                const partsSection = document.getElementById('partsSection');
                if (!partsSection || partsSection.classList.contains('hidden')) {
                    return;
                }
                
                // Ctrl+V (붙여넣기) 처리
                if ((e.ctrlKey || e.metaKey) && (e.key === 'v' || e.key === 'V')) {
                    e.preventDefault();
                    e.stopPropagation();
                    const barcodeInput = document.getElementById('barcodeInput');
                    if (barcodeInput) {
                        barcodeInput.focus();
                        // 클립보드에서 붙여넣기 (비동기)
                        navigator.clipboard.readText().then(text => {
                            setBarcodeValue(text);
                            // 바코드가 입력되면 자동 스캔
                            setTimeout(() => {
                                if (getBarcodeValue().length > 0) {
                                    scanBarcode();
                                }
                            }, 150);
                        }).catch(err => {
                            console.error('클립보드 읽기 실패:', err);
                        });
                    }
                    return;
                }
                
                const barcodeInput = document.getElementById('barcodeInput');
                if (!barcodeInput || barcodeInput.classList.contains('hidden')) {
                    return;
                }
                
                // Ctrl, Alt, Shift 등의 조합키는 무시
                if (e.ctrlKey || e.altKey || e.metaKey) {
                    return;
                }
                
                // 특수 키는 무시 (Tab, Escape 등)
                if (e.key.length > 1 && !['Enter', 'Backspace'].includes(e.key)) {
                    return;
                }
                
                // 입력 필드가 포커스되어 있지 않으면 바코드 입력창에 자동 포커스
                if (activeElement !== barcodeInput && 
                    activeElement.tagName !== 'INPUT' && 
                    activeElement.tagName !== 'SELECT' && 
                    activeElement.tagName !== 'TEXTAREA') {
                    
                    // 일반 문자나 Enter, Backspace 키인 경우에만 처리
                    if (e.key.length === 1) {
                        e.preventDefault();
                        e.stopPropagation();
                        // 포커스 확인 및 설정
                        if (activeElement !== barcodeInput) {
                            barcodeInput.focus();
                        }
                        // 키 입력을 바코드 입력창에 직접 추가
                        const currentValue = getBarcodeValue();
                        setBarcodeValue(currentValue + e.key);
                        // 바코드 패턴 확인 후 자동 스캔
                        checkAndAutoScan(getBarcodeValue());
                    } else if (e.key === 'Enter') {
                        e.preventDefault();
                        e.stopPropagation();
                        if (activeElement !== barcodeInput) {
                            barcodeInput.focus();
                        }
                        if (getBarcodeValue().length > 0) {
                            scanBarcode();
                        }
                    } else if (e.key === 'Backspace') {
                        e.preventDefault();
                        e.stopPropagation();
                        if (activeElement !== barcodeInput) {
                            barcodeInput.focus();
                        }
                        const currentValue = getBarcodeValue();
                        setBarcodeValue(currentValue.slice(0, -1));
                    }
                    return;
                }
                
                // 바코드 입력창에 포커스가 있어도 전역 이벤트로 처리 (스캐너 입력 보장)
                if (activeElement === barcodeInput) {
                    // 일반 문자 입력 처리
                    if (e.key.length === 1) {
                        e.preventDefault();
                        e.stopPropagation();
                        const currentValue = getBarcodeValue();
                        setBarcodeValue(currentValue + e.key);
                        checkAndAutoScan(getBarcodeValue());
                    }
                    return;
                }
                
                // Enter 키로 바코드 입력 완료
                if (e.key === 'Enter') {
                    e.preventDefault();
                    e.stopPropagation();
                    if (getBarcodeValue().length > 0) {
                        scanBarcode();
                    }
                    return;
                }
                
                // Backspace 키 처리
                if (e.key === 'Backspace') {
                    e.preventDefault();
                    e.stopPropagation();
                    if (activeElement !== barcodeInput) {
                        barcodeInput.focus();
                    }
                    const currentValue = getBarcodeValue();
                    setBarcodeValue(currentValue.slice(0, -1));
                    return;
                }
                
                // 일반 문자 입력
                if (e.key.length === 1) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (activeElement !== barcodeInput) {
                        barcodeInput.focus();
                    }
                    const currentValue = getBarcodeValue();
                    setBarcodeValue(currentValue + e.key);
                    checkAndAutoScan(getBarcodeValue());
                }
            }, true); // capture phase에서 이벤트 캡처
            
            // 붙여넣기 이벤트 리스너 추가 (모든 경우 처리)
            document.addEventListener('paste', function(e) {
                const partsSection = document.getElementById('partsSection');
                if (!partsSection || partsSection.classList.contains('hidden')) {
                    return;
                }
                
                const barcodeInput = document.getElementById('barcodeInput');
                if (!barcodeInput || barcodeInput.classList.contains('hidden')) {
                    return;
                }
                
                // 바코드 입력창이 아닌 곳에서 붙여넣기 시 자동으로 바코드 입력창으로 이동
                const activeElement = document.activeElement;
                if (activeElement && activeElement.id !== 'barcodeInput') {
                    e.preventDefault();
                    e.stopPropagation();
                    barcodeInput.focus();
                    // contenteditable은 select()를 지원하지 않음
                    
                    // 클립보드 데이터 가져오기
                    const pastedText = (e.clipboardData || window.clipboardData).getData('text');
                    if (pastedText) {
                        console.log('붙여넣기 이벤트:', pastedText);
                        setBarcodeValue(pastedText);
                        // 바코드가 입력되면 자동 스캔
                        setTimeout(() => {
                            if (getBarcodeValue().length > 0) {
                                console.log('붙여넣기 후 자동 스캔:', getBarcodeValue());
                                scanBarcode();
                            }
                        }, 150);
                    }
                }
            });

            // 전역 바코드 입력 상태는 차수 선택 후에만 표시
            // showGlobalBarcodeStatus(); // 차수 선택 전에는 표시하지 않음

            // 바코드 입력 이벤트
            document.getElementById('barcodeInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    scanBarcode();
                }
            });

            // 바코드 입력 필드 포커스
            document.getElementById('barcodeInput').addEventListener('focus', function() {
                // contenteditable은 select()를 지원하지 않음
            });

            // 자동 엔터키 처리 (바코드 스캐너용)
            let barcodeInputTimer = null;
            document.getElementById('barcodeInput').addEventListener('input', function(e) {
                const input = e.target;
                const value = input.value;
                
                // 이전 타이머 클리어
                if (barcodeInputTimer) {
                    clearTimeout(barcodeInputTimer);
                }
                
                // GS1-128 바코드 패턴 확인 (정확한 패턴)
                const isGS1BarcodePattern = /^\[\)>\*06:D\d+:5K:23L:24L:P\d{5}[a-zA-Z]\d{4}:7Q\d+:3S[^:]+:VP\d+\*EOT$/.test(value);
                
                // 바코드 길이가 30자 이상이거나 GS1 패턴이 맞으면 자동 엔터
                if (value.length >= 30 || (value.length >= 20 && isGS1BarcodePattern)) {
                    barcodeInputTimer = setTimeout(() => {
                        // 엔터키 이벤트 시뮬레이션
                        const enterEvent = new KeyboardEvent('keypress', {
                            key: 'Enter',
                            code: 'Enter',
                            keyCode: 13,
                            which: 13,
                            bubbles: true,
                            cancelable: true
                        });
                        input.dispatchEvent(enterEvent);
                    }, 50);
                }
            });

            // 포커스 유지 기능
            document.addEventListener('click', function(event) {
                // 바코드 입력창이나 관련 요소 클릭 시 포커스 유지하지 않음
                if (event.target.closest('#barcodeInput') || 
                    event.target.closest('#dateSelect') ||
                    event.target.closest('#shiftSelect') ||
                    event.target.closest('button')) {
                    return;
                }
                
                // 다른 곳 클릭 시 바코드 입력창에 포커스
                const barcodeInput = document.getElementById('barcodeInput');
                if (barcodeInput && !barcodeInput.classList.contains('hidden')) {
                    setTimeout(() => {
                        barcodeInput.focus();
                    }, 100);
                }
            });

            // 키보드 이벤트로 포커스 유지
            document.addEventListener('keydown', function(event) {
                // 특정 키나 요소에서 포커스 유지하지 않음
                if (event.target.closest('#dateSelect') || 
                    event.target.closest('#shiftSelect') ||
                    event.target.closest('button') ||
                    event.key === 'Tab') {
                    return;
                }
                
                // 다른 키 입력 시 바코드 입력창에 포커스
                const barcodeInput = document.getElementById('barcodeInput');
                if (barcodeInput && !barcodeInput.classList.contains('hidden') && 
                    event.target.id !== 'barcodeInput') {
                    barcodeInput.focus();
                    // contenteditable은 select()를 지원하지 않음
                }
            });
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // Supabase 초기화
            if (initializeSupabase()) {
                console.log('Supabase 초기화 성공');
            } else {
                console.error('Supabase 초기화 실패');
            }
            
            // 이벤트 리스너 설정
            setupEventListeners();
            
            // 시간 업데이트 시작
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // 오늘 날짜를 기본값으로 설정
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const todayString = `${year}-${month}-${day}`;
            
            document.getElementById('dateSelect').value = todayString;
            currentDate = todayString;
        });

        // AS 수동 입력 섹션 표시/숨김
        function showAsManualSection() {
            document.getElementById('asManualSection').classList.remove('hidden');
        }
        
        function hideAsManualSection() {
            document.getElementById('asManualSection').classList.add('hidden');
        }
        
        // 마스터 파트 목록 로드
        async function loadMasterParts() {
            try {
                const { data, error } = await supabase
                    .from('parts')
                    .select('part_number, category')
                    .order('part_number');
                
                if (error) throw error;
                
                const select = document.getElementById('asPartSelect');
                select.innerHTML = `<option value="">${i18n.t('select_part_manual')}</option>`;
                
                data.forEach(part => {
                    const option = document.createElement('option');
                    option.value = part.part_number;
                    option.textContent = `${part.part_number} - ${part.category || 'N/A'}`;
                    select.appendChild(option);
                });
                
                console.log('마스터 파트 목록 로드 완료:', data.length, '개');
            } catch (error) {
                console.error('마스터 파트 로드 오류:', error);
                alert(i18n.t('error_prefix') + '마스터 파트 목록을 불러올 수 없습니다.');
            }
        }
        
        // AS 파트 추가
        function addAsPart() {
            const partSelect = document.getElementById('asPartSelect');
            const quantityInput = document.getElementById('asQuantityInput');
            
            const partNumber = partSelect.value;
            const quantity = parseInt(quantityInput.value);
            
            if (!partNumber) {
                alert(i18n.t('error_prefix') + i18n.t('select_part_required'));
                return;
            }
            
            if (!quantity || quantity <= 0) {
                alert(i18n.t('error_prefix') + i18n.t('quantity_required'));
                return;
            }
            
            // 스캔된 파트에 추가
            if (scannedParts[partNumber]) {
                scannedParts[partNumber].scannedQuantity += quantity;
            } else {
                scannedParts[partNumber] = {
                    partNumber: partNumber,
                    registeredQuantity: 0, // AS는 등록된 수량이 없음
                    scannedQuantity: quantity,
                    remainingQuantity: 0,
                    cart: 1
                };
            }
            
            // 파트 목록 업데이트
            renderPartsList();
            
            // 입력 필드 초기화
            clearAsInput();
            
            // 확인 섹션 표시
            document.getElementById('confirmationButtons').classList.remove('hidden');
            
            console.log('AS 파트 추가:', partNumber, quantity);
        }
        
        // AS 입력 초기화
        function clearAsInput() {
            document.getElementById('asPartSelect').value = '';
            document.getElementById('asQuantityInput').value = '';
        }
        
        // 터치 이벤트 최적화
        document.addEventListener('touchstart', function() {}, {passive: true});
        document.addEventListener('touchmove', function() {}, {passive: true});
    </script>
</body>
</html> 