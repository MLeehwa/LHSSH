<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>차수 데이터 테스트</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .data-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .sequence-item { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .error { color: red; }
        .success { color: green; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>차수 데이터 테스트</h1>
        
        <div class="data-section">
            <h2>출고 시퀀스 데이터</h2>
            <button onclick="loadSequences()">데이터 로드</button>
            <div id="sequencesData"></div>
        </div>
        
        <div class="data-section">
            <h2>출고 파트 데이터</h2>
            <button onclick="loadParts()">데이터 로드</button>
            <div id="partsData"></div>
        </div>
        
        <div class="data-section">
            <h2>새 차수 등록 테스트</h2>
            <button onclick="createTestSequence()">테스트 차수 생성</button>
            <div id="testResult"></div>
        </div>
    </div>

    <script>
        // Supabase 클라이언트 초기화
        const supabase = supabase.createClient(
            'https://vzemucykhxlxgjuldibf.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ6ZW11Y3lraHhseGdqdWxkaWJmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMzNzA4MjcsImV4cCI6MjA2ODk0NjgyN30.L9DN-V33rQj6atDnDhVeIOyzGP5I_3uVWSVfMObqrbQ'
        );

        async function loadSequences() {
            try {
                const { data, error } = await supabase
                    .from('outbound_sequences')
                    .select('*')
                    .order('date', { ascending: false })
                    .limit(10);

                if (error) {
                    document.getElementById('sequencesData').innerHTML = `<p class="error">오류: ${error.message}</p>`;
                    return;
                }

                let html = '<h3>최근 10개 시퀀스:</h3>';
                if (data && data.length > 0) {
                    data.forEach(seq => {
                        html += `
                            <div class="sequence-item">
                                <strong>ID:</strong> ${seq.id}<br>
                                <strong>날짜:</strong> ${seq.date}<br>
                                <strong>차수:</strong> ${seq.seq} (타입: ${typeof seq.seq})<br>
                                <strong>상태:</strong> ${seq.status}<br>
                                <strong>파트 수:</strong> ${seq.part_count}<br>
                                <strong>총 스캔:</strong> ${seq.total_scanned}<br>
                                <strong>총 실제:</strong> ${seq.total_actual}
                            </div>
                        `;
                    });
                } else {
                    html += '<p>데이터가 없습니다.</p>';
                }
                
                document.getElementById('sequencesData').innerHTML = html;
            } catch (error) {
                document.getElementById('sequencesData').innerHTML = `<p class="error">예외 발생: ${error.message}</p>`;
            }
        }

        async function loadParts() {
            try {
                const { data, error } = await supabase
                    .from('outbound_parts')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(10);

                if (error) {
                    document.getElementById('partsData').innerHTML = `<p class="error">오류: ${error.message}</p>`;
                    return;
                }

                let html = '<h3>최근 10개 파트:</h3>';
                if (data && data.length > 0) {
                    data.forEach(part => {
                        html += `
                            <div class="sequence-item">
                                <strong>ID:</strong> ${part.id}<br>
                                <strong>시퀀스 ID:</strong> ${part.sequence_id}<br>
                                <strong>파트 번호:</strong> ${part.part_number}<br>
                                <strong>스캔 수량:</strong> ${part.scanned_qty}<br>
                                <strong>실제 수량:</strong> ${part.actual_qty}<br>
                                <strong>상태:</strong> ${part.status}
                            </div>
                        `;
                    });
                } else {
                    html += '<p>데이터가 없습니다.</p>';
                }
                
                document.getElementById('partsData').innerHTML = html;
            } catch (error) {
                document.getElementById('partsData').innerHTML = `<p class="error">예외 발생: ${error.message}</p>`;
            }
        }

        async function createTestSequence() {
            try {
                const testDate = new Date().toISOString().split('T')[0];
                const testSeq = Math.floor(Math.random() * 5) + 1; // 1-5 사이의 랜덤 차수
                
                // 테스트 시퀀스 생성
                const { data: newSequence, error: seqError } = await supabase
                    .from('outbound_sequences')
                    .insert({
                        date: testDate,
                        seq: testSeq,
                        part_count: 1,
                        total_scanned: 0,
                        total_actual: 10,
                        status: 'PENDING'
                    })
                    .select()
                    .single();

                if (seqError) {
                    throw seqError;
                }

                // 테스트 파트 생성
                const { error: partError } = await supabase
                    .from('outbound_parts')
                    .insert({
                        sequence_id: newSequence.id,
                        part_number: 'TEST-12345',
                        scanned_qty: 0,
                        actual_qty: 10,
                        status: 'PENDING'
                    });

                if (partError) {
                    throw partError;
                }

                document.getElementById('testResult').innerHTML = `
                    <p class="success">테스트 차수 생성 성공!</p>
                    <div class="sequence-item">
                        <strong>새 시퀀스 ID:</strong> ${newSequence.id}<br>
                        <strong>날짜:</strong> ${newSequence.date}<br>
                        <strong>차수:</strong> ${newSequence.seq}<br>
                        <strong>상태:</strong> ${newSequence.status}
                    </div>
                `;

                // 3초 후 데이터 새로고침
                setTimeout(() => {
                    loadSequences();
                    loadParts();
                }, 3000);

            } catch (error) {
                document.getElementById('testResult').innerHTML = `<p class="error">테스트 실패: ${error.message}</p>`;
            }
        }

        // 페이지 로드 시 자동으로 데이터 로드
        window.addEventListener('load', () => {
            loadSequences();
            loadParts();
        });
    </script>
</body>
</html> 